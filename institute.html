<!DOCTYPE html>
<html>
<head>
  <title>Institutes | Lets Teach</title>
  <meta charset="UTF-8" />
</head>
<body>

<h2>Browse Institutes</h2>

<input id="city" placeholder="Enter city">
<button onclick="loadInstitutes()">Search</button>

<hr>

<ul id="list"></ul>

<script>
const BASE_URL = "https://express-hello-world-uh96.onrender.com";

function loadInstitutes() {
  const city = document.getElementById("city").value.trim();
  let url = `${BASE_URL}/api/institute/browse`;
  if (city) url += `?city=${encodeURIComponent(city)}`;

  fetch(url)
    .then(res => res.json())
    .then(data => {
      const ul = document.getElementById("list");
      ul.innerHTML = "";

      if (!data.institutes || data.institutes.length === 0) {
        ul.innerHTML = "<li>No institutes found</li>";
        return;
      }

      data.institutes.forEach(i => {
        const li = document.createElement("li");

        li.innerHTML = `
          <b>${i.name}</b> (${i.city})<br>
          Subjects: ${(i.subjectsNeeded || []).join(", ") || "â€”"}<br>
        `;

        if (i.registered) {
          li.innerHTML += `
            <button onclick="invite('${i.uid}')">
              Invite / Chat
            </button>
          `;
        } else {
          li.innerHTML += `
            <small>ðŸ“ž Contact institute to register</small>
          `;
        }

        li.innerHTML += "<hr>";
        ul.appendChild(li);
      });
    })
    .catch(() => alert("Server error"));
}

function invite(uid) {
  const me = localStorage.getItem("uid");
  const type = localStorage.getItem("userType");

  if (!me || type !== "teacher") {
    alert("Login as teacher to invite");
    window.location.href = "login.html";
    return;
  }

  window.location.href = `teacher-dashboard.html`;
}
</script>

</body>
</html>
