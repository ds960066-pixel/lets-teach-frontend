<!DOCTYPE html>
<html>
<head>
  <title>Lets Teach Chat</title>

  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

  <style>
    body {
      font-family: Arial;
      background: #f4f4f4;
      padding: 15px;
    }

    #chatBox {
      background: #fff;
      height: 350px;
      overflow-y: auto;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 10px;
      display: flex;
      flex-direction: column;
    }

    .me {
      align-self: flex-end;
      background: #dcf8c6;
      padding: 6px 10px;
      margin: 4px 0;
      border-radius: 6px;
      max-width: 70%;
    }

    .other {
      align-self: flex-start;
      background: #eee;
      padding: 6px 10px;
      margin: 4px 0;
      border-radius: 6px;
      max-width: 70%;
    }

    input {
      width: 75%;
      padding: 8px;
    }

    button {
      padding: 8px 14px;
    }
  </style>
</head>

<body>

<h3>Chat</h3>

<div id="chatBox"></div>

<input id="message" placeholder="Type message..." />
<button onclick="sendMessage()">Send</button>

<script>
const BASE_URL = "https://express-hello-world-uh96.onrender.com";

/* ---------- PARAMS ---------- */
const params = new URLSearchParams(window.location.search);
const senderUid = params.get("senderUid");
const receiverUid = params.get("receiverUid");

/* ---------- ROOM ID ---------- */
const roomId = [senderUid, receiverUid].sort().join("_");

/* ---------- SOCKET ---------- */
const socket = io(BASE_URL);

socket.on("connect", () => {
  socket.emit("joinRoom", roomId);
});

/* ---------- UI HELPERS ---------- */
function appendMessage(from, text) {
  const box = document.getElementById("chatBox");
  const div = document.createElement("div");
  div.className = from === senderUid ? "me" : "other";
  div.innerText = text;
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
}

/* ---------- SEND ---------- */
function sendMessage() {
  const text = document.getElementById("message").value.trim();
  if (!text) return;

  // âœ… show instantly (important fix)
  appendMessage(senderUid, text);

  socket.emit("sendMessage", {
    senderUid,
    receiverUid,
    text,
    roomId
  });

  document.getElementById("message").value = "";
}

/* ---------- RECEIVE ---------- */
socket.on("receiveMessage", (msg) => {
  if (msg.senderUid !== senderUid) {
    appendMessage(msg.senderUid, msg.text);
  }
});
</script>

</body>
</html>
