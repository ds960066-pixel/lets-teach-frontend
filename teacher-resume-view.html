<!DOCTYPE html>
<html>
<head>
  <title>Teacher Resume | Lets Teach</title>

  <!-- Backend Base URL -->
  <script src="./config.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #ececec;
      padding: 20px;
    }

    .resume {
      background: white;
      max-width: 800px;
      margin: auto;
      padding: 30px;
      border-radius: 6px;
    }

    h1 {
      margin-bottom: 5px;
      color: #2e86de;
    }

    h3 {
      border-bottom: 2px solid #2e86de;
      padding-bottom: 5px;
      margin-top: 25px;
    }

    .tag {
      display: inline-block;
      background: #d6eaf8;
      padding: 6px 10px;
      margin: 5px 5px 0 0;
      border-radius: 4px;
    }

    button {
      margin-top: 10px;
      padding: 10px 15px;
      background: #27ae60;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }

    .btn-blue {
      background: #2e86de;
    }

    .muted {
      color: #666;
      font-size: 14px;
    }

    a { color: #2e86de; }
  </style>
</head>

<body>

<div class="resume">

  <h1 id="name">Loading...</h1>
  <p><b>üìû Phone:</b> <span id="phone">‚Äî</span></p>
  <p><b>üìç City:</b> <span id="city">‚Äî</span></p>

  <div id="pdfBox" style="margin-top:10px;"></div>

  <h3>Professional Summary</h3>
  <p id="about">‚Äî</p>

  <h3>Education</h3>
  <p id="education">‚Äî</p>

  <h3>Skills</h3>
  <div id="skills">‚Äî</div>

  <button class="btn-blue" onclick="window.print()">Download (Print to PDF)</button>

</div>

<script>
const BASE_URL = "https://lets-teach-backend-v38i.onrender.com";

/* ================= GET UID ================= */
const params = new URLSearchParams(window.location.search);
const uid = params.get("uid") || localStorage.getItem("uid");

if (!uid) {
  alert("Teacher UID missing");
  window.location.href = "login.html";
}

/* ================= HELPERS ================= */
function buildResumeLink(resumeUrl) {
  if (!resumeUrl) return null;
  if (resumeUrl.startsWith("http")) return resumeUrl;
  if (resumeUrl.startsWith("/")) return `${BASE_URL}${resumeUrl}`;
  return `${BASE_URL}/${resumeUrl}`;
}

/* ================= LOAD RESUME ================= */
fetch(`${BASE_URL}/api/teacher/${uid}`)
  .then(res => res.json())
  .then(data => {
    if (!data.success || !data.teacher) {
      alert("Teacher not found");
      return;
    }

    const t = data.teacher;

    document.getElementById("name").innerText = t.name || "Teacher";
    document.getElementById("phone").innerText = t.phone || "‚Äî";
    document.getElementById("city").innerText = t.city || "‚Äî";

    document.getElementById("about").innerText =
      t.about ? t.about : "No summary added yet";

    document.getElementById("education").innerText =
      t.education ? t.education : "‚Äî";

    // Skills tags
    const skillsBox = document.getElementById("skills");
    skillsBox.innerHTML = "";

    if (Array.isArray(t.skills) && t.skills.length) {
      t.skills.forEach(s => {
        const span = document.createElement("span");
        span.className = "tag";
        span.innerText = s;
        skillsBox.appendChild(span);
      });
    } else {
      skillsBox.innerText = "‚Äî";
    }

    // Resume PDF buttons (if uploaded)
    const pdfBox = document.getElementById("pdfBox");
    const pdfLink = buildResumeLink(t.resumeUrl);

    if (pdfLink) {
      pdfBox.innerHTML = `
        <p class="muted">‚úÖ Resume PDF uploaded:</p>
        <a href="${pdfLink}" target="_blank">View PDF</a>
        &nbsp; | &nbsp;
        <a href="${pdfLink}" download>Download PDF</a>
      `;
    } else {
      pdfBox.innerHTML = `<p class="muted">‚ùå Resume PDF not uploaded</p>`;
    }
  })
  .catch(err => {
    console.error(err);
    alert("Server error");
  });
</script>

</body>
</html>
