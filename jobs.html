<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Teaching Jobs | Lets Teach</title>
  <meta name="description"
        content="Browse teaching jobs by city and subject. Teachers can apply after login. Jobs are posted by schools and coaching institutes." />
  <link rel="canonical"
        href="https://ds960066-pixel.github.io/lets-teach-frontend/jobs.html">

  <!-- Backend Base URL (ONLY SOURCE) -->
  <script src="./config.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f4f4f4;
      margin: 0;
    }
    .container { max-width: 900px; margin: 0 auto; }
    h1 { margin: 0 0 8px; font-size: 28px; }
    .muted { color: #666; margin: 0 0 14px; line-height: 1.4; }
    .card {
      background: #fff;
      padding: 15px;
      margin-bottom: 12px;
      border-radius: 6px;
      border: 1px solid #eee;
    }
    .filters {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
      margin: 12px 0;
    }
    input, select {
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ddd;
      min-width: 160px;
    }
    button {
      padding: 10px 14px;
      background: #27ae60;
      color: #fff;
      border: none;
      cursor: pointer;
      border-radius: 6px;
      font-weight: 600;
    }
    button:disabled { opacity: 0.7; cursor: not-allowed; }
    .login-hint {
      background: #fff3cd;
      padding: 10px;
      margin: 12px 0;
      border-radius: 6px;
      color: #856404;
      border: 1px solid #ffeeba;
    }
    .danger {
      background: #fdecea;
      color: #611a15;
      border: 1px solid #f5c6cb;
    }
    .row {
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
      margin-top: 10px;
      color: #333;
    }
    a.btn-link {
      display: inline-block;
      padding: 10px 14px;
      border-radius: 6px;
      border: 1px solid #ddd;
      background: #fff;
      color: #111;
      text-decoration: none;
      font-weight: 600;
    }
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 999px;
      background: #f1f1f1;
      font-size: 12px;
      margin-left: 8px;
    }
  </style>
</head>

<body>
<div class="container">

  <h1>Teaching Jobs <span class="badge">Lets Teach</span></h1>
  <p class="muted">
    Browse teaching jobs by <b>city</b> and <b>subject</b>.
    Teachers can apply after login.
  </p>

  <div id="loginHint" class="login-hint" style="display:none;">
    Please login as a <b>Teacher</b> to apply for jobs.
    <div style="margin-top:8px;">
      <a class="btn-link" href="./login.html">Login</a>
      <a class="btn-link" href="./index.html">Home</a>
    </div>
  </div>

  <div class="card">
    <div class="filters">
      <input id="city" placeholder="City" />
      <input id="subject" placeholder="Subject" />
      <select id="role">
        <option value="">Any</option>
        <option value="part-time">Part-time</option>
        <option value="full-time">Full-time</option>
      </select>
      <button id="searchBtn" onclick="loadJobs()">Search</button>
    </div>
  </div>

  <!-- Static preview (SEO / soft-404 safe) -->
  <div id="jobs">
    <div class="card"><b>Sample Job</b> â€“ Login as teacher to apply</div>
  </div>

</div>

<script>
/* ===== AUTH STATE ===== */
const uid = localStorage.getItem("uid");
const userType = localStorage.getItem("role");

if (!uid || userType !== "teacher") {
  document.getElementById("loginHint").style.display = "block";
}

/* ===== HELPERS ===== */
function escapeHtml(str) {
  return String(str)
    .replaceAll("&", "&amp;")
    .replaceAll("<", "&lt;")
    .replaceAll(">", "&gt;")
    .replaceAll('"', "&quot;")
    .replaceAll("'", "&#039;");
}

function buildBrowseUrl() {
  const city = cityInput.value.trim();
  const subject = subjectInput.value.trim();
  const role = roleInput.value.trim();

  const params = new URLSearchParams();
  if (city) params.set("city", city);
  if (subject) params.set("subject", subject);
  if (role) params.set("role", role);

  return `${BASE_URL}/api/job/browse?${params.toString()}`;
}

function setLoading(v) {
  searchBtn.disabled = v;
  searchBtn.textContent = v ? "Loading..." : "Search";
}

/* ===== LOAD JOBS (GLOBAL) ===== */
window.loadJobs = async function () {
  const box = document.getElementById("jobs");
  setLoading(true);

  try {
    const res = awai
